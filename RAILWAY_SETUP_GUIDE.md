# üöÄ Railway Deployment - Step by Step

## Current Status
You have: ‚úÖ PostgreSQL database
You need: ‚ùå Backend API service

## Step-by-Step Setup

### Step 1: Add Backend Service (The NestJS App)

1. **Go to your Railway project**
   - Visit: https://railway.app/project/becf6c34-b309-4829-8206-945c92b949fe
   - Or go to Railway Dashboard ‚Üí Your Project

2. **Click "New" or "+ New"**
   - You'll see options: "Empty Service", "GitHub Repo", "Database", etc.

3. **Select "GitHub Repo"**
   - Click "Deploy from GitHub repo"
   - Choose your repository (the one with the backend code)
   - Railway will clone your repo

4. **Configure the Service**
   - Railway auto-detects it's a Node.js app
   - It will automatically:
     - Install dependencies (`npm install`)
     - Build the app (`npm run build`)
     - Start the app (`npm run start:prod`)

### Step 2: Connect PostgreSQL to Backend

1. **Add Database Connection**
   - In your backend service, click "Variables" or "Settings"
   - Look for "Generate Domain" or "Connect to Database"
   - Click "Add PostgreSQL variable"
   - Railway will create: `DATABASE_URL`

2. **Check Environment Variables**
   - Backend service ‚Üí "Variables" tab
   - You should see:
     ```
     DATABASE_URL=${{postgres.DATABASE_URL}}
     ```
   - This automatically connects to your PostgreSQL instance

### Step 3: Add Redis (Optional but Recommended)

1. **Go back to your project**
   - Click "New" ‚Üí "Database" ‚Üí "Add Redis"

2. **Note the Redis connection variables**
   - Railway will provide: `REDIS_URL` or `REDIS_HOST`, `REDIS_PORT`
   - You'll need to manually add these to your backend service

### Step 4: Configure Environment Variables

Go to your **Backend Service** ‚Üí "Variables" tab

Add these required variables:

```env
# Database (auto-generated by Railway)
DATABASE_URL=${{postgres.DATABASE_URL}}

# Redis (if you added Redis)
REDIS_HOST=${{redis.REDIS_HOST}}
REDIS_PORT=${{redis.REDIS_PORT}}

# JWT Secrets (generate secure random strings)
JWT_SECRET=your-super-secret-jwt-key-minimum-32-characters-long
JWT_REFRESH_SECRET=your-super-secret-refresh-key-minimum-32-characters-long

# App Configuration
NODE_ENV=production
PORT=3000

# CORS (for your mobile app)
CORS_ORIGIN=*
```

### Step 5: Connect Redis to Backend

1. **Go to Backend Service ‚Üí Variables**
2. **Click "New Variable"**
3. **Add each Redis variable manually:**
   - Name: `REDIS_HOST`
   - Value: Look at your Redis service ‚Üí Connect ‚Üí Copy HOST value
   
   - Name: `REDIS_PORT`  
   - Value: Copy PORT value (usually 6379)
   
   - Name: `REDIS_PASSWORD` (if set)
   - Value: Copy PASSWORD value

### Step 6: Deploy and Get URL

1. **Railway will automatically deploy**
2. **Wait for build to complete** (2-5 minutes)
3. **Get your public URL:**
   - Click on your Backend service
   - Click "Settings" or "Networking"
   - Click "Generate Domain" if not already done
   - Copy the URL: e.g., `https://project-bull-production.up.railway.app`

### Step 7: Run Database Migrations

1. **Go to your Backend service**
2. **Click "Deploy" tab**
3. **Open the deployment terminal**
4. **Run migrations:**
   ```bash
   npx prisma migrate deploy
   ```

Or use Railway CLI (if installed):
```bash
railway run npx prisma migrate deploy
```

### Step 8: Update Your Mobile App

Update your app to use the Railway URL:

```typescript
// config/app-config.ts
const getApiBaseUrl = () => {
  if (__DEV__) {
    return 'http://10.0.2.2:3000'; // Local development
  }
  return 'https://project-bull-production.up.railway.app'; // Production
};
```

## Troubleshooting

### Build Fails
- Check logs in Railway dashboard
- Ensure `package.json` has `start:prod` script
- Verify Node.js version compatibility

### Database Connection Issues
- Check DATABASE_URL is set correctly
- Verify PostgreSQL service is running
- Look at backend logs for connection errors

### App Can't Connect
- Check the Railway URL is correct
- Verify CORS settings allow your mobile app
- Check backend is running (green status in Railway)

## Quick Reference

**Your Project**: https://railway.app/project/becf6c34-b309-4829-8206-945c92b949fe

**Services Needed**:
1. ‚úÖ PostgreSQL (already have)
2. ‚ùå Backend Service (NestJS app)
3. ‚ùå Redis (optional for now)

**Next Steps**:
1. Add backend service from GitHub
2. Connect PostgreSQL
3. Add environment variables
4. Deploy
5. Get URL
6. Update mobile app config

